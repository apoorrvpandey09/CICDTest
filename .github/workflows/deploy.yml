name: Development Pipeline
on:
  push:
    branches: 
        - development/cicdtest
env:
    PROJECT NAME: CICD Test1
    ORCH_FOLDER: Dev
    ORCH_URL: https://cloud.uipath.com/
    ORCH_TENANT: rsutra
    ORCH_CLIENT_ID: ${{secrets.ORCH_CLIENT_ID_Dev}} 
    ORCH_USER_KEY: ${{secrets.ORCH_USER_Key_Dev}}
    ORCH_ACC_NAME: rsutrvxddqcf
    CLI_URL: https://uipath.visualstudio.com/Public.Feeds/_artifacts/feed/UiPath-Official/NuGet/UiPath.CLI.Windows/overview/23.10.8894.39673
jobs:
 print-details:
    runs-on: windows-latest
    steps:
      - name: echo-default-env-variables
        run:  |
          echo "Hone: ${HOME}"
          echo "GITHUB_WORKFLOW: ${GITHUB_WORKFLOW}"
          echo "GITHUB_ACTIONS: ${GITHUB_ACTIONS}"
          echo "GITHUB_ACTOR: ${GITHUB_ACTOR}"
          echo "GITHUB_REPOSITORY: ${GITHUB_REPOSITORY}"
          echo "GITHUB_EVENT_NAME: ${GITHUB_EVENT_NAME}"
          echo "GITHUB_WORKSPACE: ${GITHUB_WORKSPACE}"
          echo "GITHUB_SHA" ${GITHUB_SHA}"
          echo "GITHUB_REF" $${GITHUB_REF}"
 cleaner:
    runs-on: windows-latest
    steps: 
      - name: Runner workspace Path
        run:   |
           echo "Cleaning up previous run"
           rm -rf "${{ github.workspace }}"
 build_uipath-nuget-package:
    needs: cleaner
    runs-on: windows-latest
    steps:
       - name: Check out repository code
         uses: actions/checkout@v2
       - name: Build Nuget package
         shell: pwsh
         run:  ${{ github.workspace }}\scripts\UiPathPack.ps1 ${{ github.workspace }}\project.json -destination_folder ${{ github.workspace }}\package -autoVersion -cli_url ${{env.CLI_URL}}
       - name: Upload UiPath artifacts
         uses: actions/upload-artifacts@v2
         with:
            name: artifacts
            path:   |
              package/*.*
              scripts/*.ps1
 publish-uipath-nuget-package:
    needs: build-uipath-nuget-package
    runs-on: windows-lateststeps:
    steps:
       - name: Download UiPath Articats
         uses: actions/download-articats@v2
         with:
           name: artifacts
       - name: Publish Nuget Package to Dev
         shell: pwsh
         run:   |
         ${{ github.workspace }}\scripts\UiPathDeploy.ps1 -packages_path ${{ github.workspace }}\package -orchestrator_url ${{env.ORCH_URL}} -orchestrator_tenant ${{env.ORCH_TENANT}} -account_name ${{env.ORCH_ACC_NAME}} -UserKey ${{env.ORCH_CLIENT_ID}}  -UserSecret ${{env.ORCH_USER_KEY}}  -applicationscope "OR.Assets OR.BackgroundTasks OR.Execution OR.Folders OR.Jobs OR.Machines OR.Monitoring OR.Robots OR.Settings OR.TestSetExecutions OR.TestSets OR.TestSetSchedules OR.Users" -folder_organization_unit "CICDdev" -cli_url ${{env.CLI_URL}}
